<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIFU | PANEL DE CONTROL v8.2</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Sistema inteligente de gesti√≥n operativa con IA predictiva">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SIFU Informer">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">

    <!-- MODAL ENGINE STYLES (God Mode) -->
    <link rel="stylesheet" href="modal_fix.css?v=4.5">
    <style>
        #metric-uncovered,
        #metric-absences,
        #metric-incidents {
            cursor: pointer !important;
        }
    </style>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="operational_styles.css">
    <link rel="stylesheet" href="filter_bar_sticky.css">
    <link rel="stylesheet" href="notepad.css">
    <link rel="stylesheet" href="orders_styles.css">
    <link rel="stylesheet" href="layout_styles.css">
    <link rel="stylesheet" href="smart_modules.css">
    <link rel="stylesheet" href="advanced_modules.css">
    <link rel="stylesheet" href="mobile_chat_styles.css">
    <link rel="stylesheet" href="ml_modules_styles.css">
    <link rel="stylesheet" href="integrations_export_styles.css">
    <link rel="stylesheet" href="bi_styles.css">
    <link rel="stylesheet" href="security_styles.css">
    <link rel="stylesheet" href="quality_styles_phase9.css">
    <link rel="stylesheet" href="document_styles_phase10.css">
    <link rel="stylesheet" href="financial_styles_phase11.css">
    <link rel="stylesheet" href="talent_styles_phase12.css">
    <link rel="stylesheet" href="fleet_styles_phase13.css">
    <link rel="stylesheet" href="sustainability_styles_phase14.css">
    <link rel="stylesheet" href="executive_styles_phase15.css">
    <link rel="stylesheet" href="master_sync_v2.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- TensorFlow.js para Machine Learning -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0/dist/tf.min.js"></script>
    <script src="master_sync_engine.js" defer></script>
</head>

<body class="light-theme">
    <!-- Subtle Google-style background blobs -->
    <div class="bg-blob"></div>
    <div class="bg-blob secondary"></div>

    <div class="app-shell">
        <!-- Global Top Header -->
        <header class="global-header">
            <div class="header-main">
                <div class="brand">
                    <div class="logo-box">
                        <img src="img/logo sifu.png" alt="SIFU Logo"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="brand-text">
                        <span class="brand-title">PANEL DE CONTROL</span>
                        <div id="user-security-badge" style="margin-left: 20px;"></div>
                        <div style="margin-left: 15px;">
                            <button onclick="showDirectorDashboard()"
                                style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; border: none; padding: 4px 10px; border-radius: 4px; font-size: 10px; font-weight: bold; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); letter-spacing: 0.5px;">
                                üëÅÔ∏è VISI√ìN DIRECTIVA
                            </button>
                        </div>
                    </div>
                </div>

                <div class="global-search">
                    <div class="search-wrapper">
                        <input type="text" id="global-search-input"
                            placeholder="BUSCAR TRABAJADORA, CENTRO O SERVICIO...">
                        <button id="voice-command-btn" class="voice-btn" title="Activar Comandos de Voz">üéôÔ∏è</button>
                    </div>
                </div>

                <div class="header-comm-links">
                    <button class="comm-icon-btn notification-bell"
                        onclick="NotificationsEngine.toggleNotificationCenter()" title="Centro de Notificaciones">
                        <span>üîî</span>
                        <div id="notification-badge" style="display: none;">0</div>
                    </button>
                    <button class="comm-icon-btn wa" onclick="window.open('https://web.whatsapp.com/', '_blank')"
                        title="WhatsApp Web">
                        <span>üí¨</span>
                    </button>
                    <button class="comm-icon-btn out"
                        onclick="window.open('https://outlook.office.com/mail/', '_blank')" title="Outlook Corporativo">
                        <span>üìß</span>
                    </button>
                </div>

                <div class="header-stats">
                    <div class="h-stat-item">
                        <span id="last-sync-time"
                            style="font-size: 8px; color: var(--text-dim); margin-top: 4px;">√öLTIMA SYNC: HOY
                            --:--</span>
                        <input type="file" id="master-file-input" style="display: none;" accept=".xlsx, .xls">
                        <button id="btn-load-master" style="display:none;"></button>
                    </div>

                    <div class="h-stat-item">
                        <div class="h-stat-label">INCIDENCIAS</div>
                        <div class="h-stat-value" id="h-stat-incidents">0</div>
                    </div>

                    <div class="h-stat-item clickable" title="Click para editar plantilla">
                        <div class="h-stat-label">OPERARIOS</div>
                        <div class="h-stat-value" id="h-stat-active">24</div>
                    </div>

                    <div class="h-stat-item">
                        <div class="h-stat-label">EFICIENCIA</div>
                        <div class="h-stat-value" id="sis-predict-val">0.0%</div>
                    </div>

                    <div class="h-stat-item">
                        <div class="h-stat-label">SATISFACCI√ìN</div>
                        <div class="h-stat-value" style="color:var(--accent-green);">9.8/10</div>
                    </div>

                    <button id="btn-situational-report" class="btn-primary-glow" onclick="openSituationalReport()">
                        <span>üìä</span> INFORME SITUACIONAL
                    </button>
                </div>
            </div>
        </header>

        <main class="content-viewport">
            <div class="dashboard-grid">
                <!-- Sidebar Removed: User requested full expansion -->

                <!-- Operational Hub (Right) -->
                <div class="operational-hub">
                    <nav class="tabs-nav">
                        <button class="tab-btn active" data-tab="master" onclick="switchTab('master')">
                            <span>üìä</span> MASTER
                        </button>
                        <button class="tab-btn" data-tab="abonos" onclick="switchTab('abonos')">
                            <span>üè•</span> GESTI√ìN BAJAS
                        </button>
                        <button class="tab-btn" data-tab="pedidos" onclick="
                            console.log('Switching to PEDIDOS tab...');
                            switchTab('pedidos');
                        "><span>üì¶</span> PEDIDOS</button>
                        <button class="tab-btn" data-tab="cuadrantes" onclick="switchTab('cuadrantes')">
                            <span>üìÖ</span> CUADRANTES
                        </button>
                        <button class="tab-btn" data-tab="descubiertos" onclick="switchTab('descubiertos')">
                            <span>üö®</span> DESCUBIERTOS
                        </button>
                        <button class="tab-btn" data-tab="resumen" onclick="switchTab('resumen')">
                            <span>üìà</span> RESUMEN
                        </button>
                        <button class="tab-btn" data-tab="smarthub" onclick="switchTab('smarthub')"
                            style="color: #667eea; font-weight: 800; border: 1px solid rgba(102, 126, 234, 0.2);">
                            <span>üß†</span> INTELIGENCIA
                        </button>
                    </nav>

                    <!-- GLOBAL METRICS BRIDGE -->
                    <section class="holographic-bridge" style="margin-top: 20px;">
                        <!-- DESCUBIERTOS -->
                        <div class="holographic-card dangerous-click" id="metric-uncovered" style="cursor: pointer;">
                            <div class="metric-orbit">
                                <div class="orbit-ring"></div>
                                <span class="metric-icon">üî•</span>
                            </div>
                            <div class="metric-info">
                                <div class="metric-label">DESCUBIERTOS</div>
                                <div class="metric-value" id="val-uncovered">0</div>
                                <div class="metric-trend" id="trend-uncovered">
                                    <span class="trend-icon">--</span>
                                    <span class="trend-text">Sin cambios</span>
                                </div>
                            </div>
                        </div>

                        <!-- BAJAS / IT -->
                        <div class="holographic-card info-click" id="metric-absences" style="cursor: pointer;">
                            <div class="metric-orbit">
                                <div class="orbit-ring"></div>
                                <span class="metric-icon">üè•</span>
                            </div>
                            <div class="metric-info">
                                <div class="metric-label">GESTI√ìN BAJAS</div>
                                <div class="metric-value" id="val-absences">0</div>
                                <div class="metric-trend neutral" id="trend-absences">
                                    <span class="trend-icon">‚óè</span>
                                    <span class="trend-text">Activas hoy</span>
                                </div>
                            </div>
                        </div>

                        <!-- INCIDENCIAS -->
                        <div class="holographic-card warning-click" id="metric-incidents" style="cursor: pointer;">
                            <div class="metric-orbit">
                                <div class="orbit-ring"></div>
                                <span class="metric-icon">‚ö†Ô∏è</span>
                            </div>
                            <div class="metric-info">
                                <div class="metric-label">INCIDENCIAS</div>
                                <div class="metric-value" id="val-incidents">0</div>
                                <div class="metric-trend" id="trend-incidents">
                                    <span class="trend-icon">--</span>
                                    <span class="trend-text">En proceso</span>
                                </div>
                            </div>
                        </div>

                        <!-- COBERTURA -->
                        <div class="holographic-card" id="metric-active" onclick="refreshMetrics()"
                            style="cursor: pointer;">
                            <div class="metric-orbit">
                                <div class="orbit-ring"></div>
                                <span class="metric-icon">üë•</span>
                            </div>
                            <div class="metric-info">
                                <div class="metric-label">COBERTURA</div>
                                <div class="metric-value" id="val-active">100%</div>
                                <div class="metric-trend down" id="trend-active">
                                    <span class="trend-icon">‚ñº</span>
                                    <span class="trend-text">Tiempo real</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <div class="tab-content active" id="tab-master">

                        <!-- MASTER TABLE VIEW -->
                        <div class="modules-container"
                            style="display: grid; grid-template-columns: 4fr 1fr; gap: 20px;">
                            <!-- LEFT COLUMN: Master Table + SharePoint Widget -->
                            <div style="display: flex; flex-direction: column; gap: 20px;">
                                <div class="module-card" id="module-master-summary">
                                    <div class="master-toolbar">
                                        <div class="toolbar-left"
                                            style="display: flex; align-items: center; gap: 20px;">
                                            <h3>VISTA GLOBAL DE SERVICIOS</h3>
                                            <div id="toolbar-stats-container" class="toolbar-stats-container">
                                                <!-- Dynamic Lila Badges Injected by JS -->
                                            </div>
                                        </div>
                                        <div class="toolbar-right"
                                            style="display: flex; align-items: center; gap: 15px;">
                                            <div class="search-wrapper">
                                                <span class="search-icon">üîç</span>
                                                <input type="text" id="master-search-input"
                                                    aria-label="Buscar en tabla maestra"
                                                    oninput="if(typeof renderMasterBodyOnly === 'function') renderMasterBodyOnly()"
                                                    placeholder="Buscar servicio, titular, centro...">
                                            </div>

                                            <button class="btn-toolbar-action excel"
                                                onclick="if(window.exportStatusToExcel) window.exportStatusToExcel(); else alert('Preparando Excel...')">
                                                <span>üìä</span> EXCEL
                                            </button>

                                            <button class="btn-toolbar-action pdf"
                                                onclick="if(window.exportStatusToPDF) window.exportStatusToPDF(); else alert('Generando PDF...')">
                                                <span>üìÑ</span> PDF
                                            </button>

                                            <!-- Dynamic Filters Area -->
                                            <div class="dynamic-filter-container">
                                                <div id="active-filters-row" class="active-filters-row">
                                                    <!-- Filters injected by JS -->
                                                </div>
                                                <div class="filter-adder-wrapper">
                                                    <button id="btn-add-filter" class="btn-add-filter"
                                                        onclick="toggleFilterMenu()">
                                                        ‚ûï FILTRO
                                                    </button>
                                                    <div id="filter-column-menu" class="filter-menu-popup">
                                                        <!-- Columns injected here -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                    <!-- Scrollable Content Wrapper -->
                                    <div class="master-content-wrapper"
                                        style="max-height: 700px; overflow-y: auto; overflow-x: hidden;">
                                        <div id="master-summary-feed" class="scroll-feed">
                                            <!-- Table JS Inject -->
                                        </div>
                                    </div>
                                </div>

                                <!-- SEGUIMIENTO DESCUBIERTOS EN TIEMPO REAL -->
                                <div class="module-card" id="module-sharepoint-tracker">
                                    <div class="card-header-flex"
                                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                                        <h3>üìä SEGUIMIENTO DESCUBIERTOS</h3>
                                        <span class="badge green">LIVE</span>
                                    </div>
                                    <div class="sharepoint-embed-container"
                                        style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                        <iframe
                                            src="https://gruposifu-my.sharepoint.com/personal/acoscolin_gruposifu_com/_layouts/15/Doc.aspx?sourcedoc={7DBC3870-2966-4E8F-A5C8-6D0202D26EBB}&action=embedview"
                                            width="100%" height="400px" frameborder="0" style="border: none;">
                                        </iframe>
                                    </div>
                                    <div
                                        style="font-size: 10px; color: var(--text-dim); margin-top: 8px; text-align: center;">
                                        üîÑ Actualizaci√≥n autom√°tica desde SharePoint
                                    </div>
                                </div>

                                <!-- CONTROL DE VENCIMIENTOS (NEW WIDGET) -->
                                <div class="module-card" id="module-contract-tracker" style="margin-top: 20px;">
                                    <div class="card-header-flex"
                                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                                        <h3>üóìÔ∏è CONTROL DE VENCIMIENTOS</h3>
                                        <div style="display:flex; gap:5px;">
                                            <button onclick="filterContractWidget('ALL')" class="btn-mini-filter active"
                                                id="btn-filter-all"
                                                style="background:#e2e8f0; color:#1e293b; border:none; padding:4px 8px; border-radius:6px; font-size:10px; font-weight:700; cursor:pointer;">TODOS</button>
                                            <button onclick="filterContractWidget('URGENT')" class="btn-mini-filter"
                                                id="btn-filter-urgent"
                                                style="background:#f1f5f9; color:#475569; border:none; padding:4px 8px; border-radius:6px; font-size:10px; font-weight:700; cursor:pointer;">URGENTES</button>
                                            <button onclick="filterContractWidget('WARNING')" class="btn-mini-filter"
                                                id="btn-filter-warning"
                                                style="background:#f1f5f9; color:#475569; border:none; padding:4px 8px; border-radius:6px; font-size:10px; font-weight:700; cursor:pointer;">PR√ìXIMOS</button>
                                            <button onclick="filterContractWidget('EXPIRED')" class="btn-mini-filter"
                                                id="btn-filter-expired"
                                                style="background:#1e293b; color:#fff; border:none; padding:4px 8px; border-radius:6px; font-size:10px; font-weight:700; cursor:pointer;">VENCIDOS</button>
                                        </div>
                                    </div>

                                    <div class="contract-list-container" style="max-height: 300px; overflow-y: auto;">
                                        <table class="simple-table"
                                            style="width:100%; border-collapse:collapse; font-size:12px;">
                                            <thead
                                                style="position:sticky; top:0; background:white; z-index:10; box-shadow:0 1px 2px rgba(0,0,0,0.05);">
                                                <tr>
                                                    <th
                                                        style="text-align:left; padding:10px; color:#64748b; font-weight:700;">
                                                        TRABAJADOR / SERVICIO</th>
                                                    <th
                                                        style="text-align:right; padding:10px; color:#64748b; font-weight:700;">
                                                        FECHA FIN</th>
                                                    <th
                                                        style="text-align:right; padding:10px; color:#64748b; font-weight:700;">
                                                        D√çAS</th>
                                                    <th
                                                        style="text-align:center; padding:10px; color:#64748b; font-weight:700;">
                                                        ESTADO</th>
                                                </tr>
                                            </thead>
                                            <tbody id="contract-widget-body">
                                                <tr>
                                                    <td colspan="4"
                                                        style="text-align:center; padding:20px; color:#94a3b8;">
                                                        Cargando
                                                        datos...</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- RIGHT COLUMN: Secondary Modules -->
                            <div class="secondary-modules">
                                <!-- SEM√ÅFORO DE RIESGO DE CLIENTES -->
                                <div class="module-card risk-module" id="module-client-risk">
                                    <div class="card-header-flex"
                                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                                        <h3>üö¶ SEM√ÅFORO DE RIESGO</h3>
                                        <span class="badge blue">SISTEMA</span>
                                    </div>
                                    <div id="risk-list" class="risk-feed">
                                        <div class="empty-state">Analizando estabilidad operativa...</div>
                                    </div>
                                </div>

                                <!-- BLOC DE NOTAS (Relocated) -->
                                <div class="module-card" id="module-notepad-right">
                                    <div class="card-header-flex"
                                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                                        <h3>üìù BLOC DE NOTAS <span class="badge blue" id="top-notes-count">0</span></h3>
                                    </div>
                                    <div class="quick-note-box" style="margin-bottom: 15px;">
                                        <input type="text" id="quick-note-top" placeholder="A√±adir tarea r√°pida..."
                                            style="width: 100%; padding: 8px 15px; border-radius: 20px; border: 1px solid #e2e8f0;">
                                    </div>
                                    <div id="top-notes-feed" class="sidebar-notes-vertical"
                                        style="display: flex; flex-direction: column; gap: 10px; max-height: 300px; overflow-y: auto;">
                                        <!-- JS Inject: Note Cards -->
                                    </div>
                                </div>

                                <!-- RADAR DE URGENCIA -->
                                <div class="module-card" id="module-urgency-radar">
                                    <h3>üìç RADAR DE URGENCIA <span class="badge red">ACTIVO</span></h3>
                                    <div id="urgency-list" class="urgency-feed">
                                        <!-- Centros cr√≠ticos inyectados aqu√≠ -->
                                    </div>
                                </div>

                                <!-- CENTRO DE ACCI√ìN R√ÅPIDA -->
                                <div class="module-card" id="module-quick-actions">
                                    <h3>‚ö° CENTRO DE ACCI√ìN R√ÅPIDA</h3>
                                    <div class="smart-action-grid">
                                        <button class="smart-btn danger" onclick="filterByUrgency('DESCUBIERTO')">
                                            <span class="icon">üö®</span>
                                            <div class="text">
                                                <strong>DESCUBIERTOS</strong>
                                                <span>Acci√≥n Inmediata</span>
                                            </div>
                                            <span id="count-descubiertos" class="smart-badge">0</span>
                                        </button>
                                        <button class="smart-btn warning" onclick="filterByUrgency('BAJA')">
                                            <span class="icon">üè•</span>
                                            <div class="text">
                                                <strong>IT SIN SUPLENTE</strong>
                                                <span>Revisar Cobertura</span>
                                            </div>
                                            <span id="count-bajas" class="smart-badge">0</span>
                                        </button>
                                        <button class="smart-btn info" onclick="filterByUrgency('MA√ëANA')">
                                            <span class="icon">üìÖ</span>
                                            <div class="text">
                                                <strong>TERMINAN HOY/MA√ë.</strong>
                                                <span>Renovar / Buscar</span>
                                            </div>
                                            <span id="count-terminan" class="smart-badge">0</span>
                                        </button>
                                        <button class="smart-btn success" onclick="clearTableFilters()">
                                            <span class="icon">üîÑ</span>
                                            <div class="text">
                                                <strong>VISTA TOTAL</strong>
                                                <span>Limpiar Filtros</span>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div> <!-- End modules-container -->
                    </div> <!-- End tab-master -->

                    <div class="tab-content" id="tab-pedidos" style="flex: 1; height: 100%;">
                        <section class="orders-section">
                            <div class="orders-header">
                                <h2 class="section-title">GESTI√ìN DE PEDIDOS</h2>
                                <div class="orders-controls">
                                    <input type="file" id="orders-file-input" accept=".xlsx"
                                        style="opacity:0; position:absolute; z-index:-1; width:1px; height:1px;"
                                        onchange="if(this.files[0]) window.handleOrdersExcel(this.files[0])">
                                    <button class="btn-primary" id="btn-load-orders"
                                        onclick="document.getElementById('orders-file-input').click()">
                                        üìÇ CARGAR
                                    </button>
                                    <button class="btn-primary" id="btn-audit-orders"
                                        style="background: var(--sifu-amber); color: #000;"
                                        onclick="window.runCleaningAudit()">
                                        üïµÔ∏è AUDITOR√çA EXPERTA
                                    </button>
                                    <div class="search-box">
                                        <input type="text" id="orders-search"
                                            placeholder="Buscar pedido, art√≠culo, c√≥digo...">
                                        <i class="fas fa-search search-icon"></i>
                                    </div>
                                </div>
                            </div>
                            <div id="orders-table-container" class="table-container">
                                <div class="empty-state">
                                    <p>üìÇ Carga el archivo "PLANTILLA PEDIDO" para ver los datos.</p>
                                </div>
                            </div>
                        </section>
                    </div>

                    <div class="tab-content" id="tab-abonos">
                        <div class="module-card" id="module-absences"
                            style="width: 100%; height: 100%; display: flex; flex-direction: column;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h3>üìâ TRABAJADORES CON BAJA IT <span class="badge blue">LIVE</span></h3>
                                <div class="action-buttons" style="display: flex; gap: 10px;">
                                    <button class="btn-secondary" onclick="exportITReport()" title="Exportar Informe">üìä
                                        EXPORTAR</button>
                                    <button class="btn-primary" onclick="showITAnalysis()"
                                        style="background: var(--sifu-blue); color: white;">
                                        üìà AN√ÅLISIS
                                    </button>
                                    <input type="text" id="it-search" placeholder="üîç Buscar trabajador..."
                                        style="padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
                                </div>
                            </div>

                            <!-- Key Metrics Row -->
                            <div
                                style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px;">
                                <div class="metric-tiny-card bg-red-light">
                                    <span class="label">BAJAS ACTIVAS</span>
                                    <strong id="it-count-total" class="value text-red">--</strong>
                                </div>
                                <div class="metric-tiny-card bg-orange-light">
                                    <span class="label">SIN SUPLIR</span>
                                    <strong id="it-count-uncovered" class="value text-orange">--</strong>
                                </div>
                                <div class="metric-tiny-card bg-blue-light">
                                    <span class="label">LARGA DURACI√ìN (>30d)</span>
                                    <strong id="it-count-long" class="value text-blue">--</strong>
                                </div>
                                <div class="metric-tiny-card bg-green-light">
                                    <span class="label">SUPLIDAS</span>
                                    <strong id="it-count-covered" class="value text-green">--</strong>
                                </div>
                            </div>

                            <div id="absences-feed" class="scroll-feed" style="flex: 1; overflow-y: auto;">
                                <!-- Table injected via JS -->
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="tab-cuadrantes">
                        <div class="module-card" style="width: 100%; min-height: 80vh;">
                            <h3>üóìÔ∏è CUADRANTE VISUAL DE SERVICIOS</h3>
                            <div id="quadrants-controls"></div>
                            <div id="quadrants-grid" style="margin-top: 15px;"></div>
                        </div>
                    </div>

                    <div class="tab-content" id="tab-descubiertos">
                        <div class="module-card" id="module-uncovered" style="width: 100%;">
                            <h3>CONTROL DE DESCUBIERTOS <span class="badge red">URGENTE</span></h3>
                            <div id="uncovered-feed" class="scroll-feed" style="max-height: 700px;"></div>
                        </div>
                    </div>



                    <div class="tab-content" id="tab-resumen">
                        <div class="module-card" id="module-summary" style="width: 100%;">
                            <div class="summary-dashboard-header" style="margin-bottom: 25px; text-align: center;">
                                <h2
                                    style="font-size: 28px; background: linear-gradient(to right, #2563eb, #1e40af); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; letter-spacing: -1px; margin-bottom: 8px;">
                                    ECOSISTEMA OPERATIVO
                                </h2>
                                <p style="color: #64748b; font-size: 14px;">An√°lisis en tiempo real del rendimiento y
                                    estabilidad del servicio</p>
                            </div>

                            <!-- TOP METRICS GRID -->
                            <div class="summary-metrics-grid"
                                style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                                <div class="metric-card-glass"
                                    style="background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.05); display: flex; align-items: center; gap: 15px; transition: transform 0.2s;">
                                    <div
                                        style="width: 50px; height: 50px; background: #fee2e2; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                                        üî•</div>
                                    <div>
                                        <div
                                            style="font-size: 12px; color: #64748b; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">
                                            Descubiertos</div>
                                        <div id="sum-val-uncovered"
                                            style="font-size: 24px; font-weight: 800; color: #dc2626;">--</div>
                                    </div>
                                </div>
                                <div class="metric-card-glass"
                                    style="background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.05); display: flex; align-items: center; gap: 15px; transition: transform 0.2s;">
                                    <div
                                        style="width: 50px; height: 50px; background: #fef3c7; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                                        üè•</div>
                                    <div>
                                        <div
                                            style="font-size: 12px; color: #64748b; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">
                                            Bajas Activas</div>
                                        <div id="sum-val-absences"
                                            style="font-size: 24px; font-weight: 800; color: #d97706;">--</div>
                                    </div>
                                </div>
                                <div class="metric-card-glass"
                                    style="background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.05); display: flex; align-items: center; gap: 15px; transition: transform 0.2s;">
                                    <div
                                        style="width: 50px; height: 50px; background: #e0f2fe; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                                        ‚ö†Ô∏è</div>
                                    <div>
                                        <div
                                            style="font-size: 12px; color: #64748b; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">
                                            Incidencias</div>
                                        <div id="sum-val-incidents"
                                            style="font-size: 24px; font-weight: 800; color: #0284c7;">--</div>
                                    </div>
                                </div>
                            </div>

                            <!-- MAIN ANALYTICS ROW -->
                            <div class="analytics-row"
                                style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                                <!-- LEFT: HEATMAP -->
                                <div class="analytics-card"
                                    style="background: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.04);">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                        <h4
                                            style="margin: 0; font-size: 16px; color: #1e293b; display: flex; align-items: center; gap: 8px;">
                                            <span
                                                style="width: 6px; height: 6px; background: #3b82f6; border-radius: 50%;"></span>
                                            MAPA DE INTENSIDAD OPERATIVA
                                        </h4>
                                        <span
                                            style="font-size: 11px; color: #94a3b8; font-weight: 600; background: #f1f5f9; padding: 4px 10px; border-radius: 20px;">√öLTIMOS
                                            7 D√çAS</span>
                                    </div>
                                    <div id="incidents-heatmap" class="heatmap-container"
                                        style="height: 300px; position: flex; justify-content: center; align-items: center;">
                                        <canvas id="heatmapCanvas"></canvas>
                                    </div>
                                </div>

                                <!-- RIGHT: EFFICIENCY RADIAL -->
                                <div class="analytics-card"
                                    style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-radius: 20px; padding: 25px; color: white; position: relative; overflow: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                                    <!-- Decoration -->
                                    <div
                                        style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(59,130,246,0.1) 0%, transparent 70%); pointer-events: none;">
                                    </div>

                                    <h4
                                        style="position: relative; z-index: 2; font-size: 14px; opacity: 0.8; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px;">
                                        √çndice de Eficiencia</h4>

                                    <div
                                        style="position: relative; width: 180px; height: 180px; display: flex; align-items: center; justify-content: center;">
                                        <svg viewBox="0 0 36 36"
                                            style="width: 100%; height: 100%; transform: rotate(-90deg);">
                                            <path
                                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                                fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="2.5" />
                                            <path id="efficiency-circle-path"
                                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                                fill="none" stroke="#3b82f6" stroke-width="2.5"
                                                stroke-dasharray="0, 100" />
                                        </svg>
                                        <div style="position: absolute; text-align: center;">
                                            <div id="sum-efficiency-val" style="font-size: 32px; font-weight: 800;">0%
                                            </div>
                                            <div style="font-size: 10px; opacity: 0.6;">COBERTURA</div>
                                        </div>
                                    </div>

                                    <div style="margin-top: 20px; text-align: center; position: relative; z-index: 2;">
                                        <div style="font-size: 12px; opacity: 0.7;">Tendencia Semanal</div>
                                        <div style="font-size: 14px; font-weight: 700; color: #4ade80;">‚ñ≤ Estabilizada
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- DETAILED BREAKDOWN ROW (NEW) -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
                                <!-- Workforce DNA -->
                                <div class="analytics-card"
                                    style="background: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.04);">
                                    <h4
                                        style="margin: 0 0 20px 0; font-size: 16px; color: #1e293b; display: flex; align-items: center; gap: 8px;">
                                        <span
                                            style="width: 6px; height: 6px; background: #8b5cf6; border-radius: 50%;"></span>
                                        ADN DE LA PLANTILLA
                                    </h4>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                        <div style="background: #f8fafc; padding: 15px; border-radius: 12px;">
                                            <div
                                                style="font-size: 11px; color: #64748b; font-weight: 700; text-transform: uppercase;">
                                                Total Trabajadores</div>
                                            <div id="sum-dna-total"
                                                style="font-size: 20px; font-weight: 800; color: #1e293b;">--</div>
                                        </div>
                                        <div style="background: #f0fdf4; padding: 15px; border-radius: 12px;">
                                            <div
                                                style="font-size: 11px; color: #166534; font-weight: 700; text-transform: uppercase;">
                                                Activos</div>
                                            <div id="sum-dna-active"
                                                style="font-size: 20px; font-weight: 800; color: #15803d;">--</div>
                                        </div>
                                        <div style="background: #fffbeb; padding: 15px; border-radius: 12px;">
                                            <div
                                                style="font-size: 11px; color: #b45309; font-weight: 700; text-transform: uppercase;">
                                                Bajas Activas</div>
                                            <div style="display:flex; align-items:baseline; gap:6px;">
                                                <div id="sum-dna-absent"
                                                    style="font-size: 20px; font-weight: 800; color: #d97706;">--</div>
                                                <span id="sum-dna-absent-rate"
                                                    style="font-size: 11px; color: #b45309;">(0%)</span>
                                            </div>
                                        </div>
                                        <div style="background: #fef2f2; padding: 15px; border-radius: 12px;">
                                            <div
                                                style="font-size: 11px; color: #991b1b; font-weight: 700; text-transform: uppercase;">
                                                Descubiertos</div>
                                            <div style="display:flex; align-items:baseline; gap:6px;">
                                                <div id="sum-dna-uncovered"
                                                    style="font-size: 20px; font-weight: 800; color: #dc2626;">--</div>
                                                <span id="sum-dna-uncovered-rate"
                                                    style="font-size: 11px; color: #991b1b;">(0%)</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Critical Services List -->
                                <div class="analytics-card"
                                    style="background: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.04);">
                                    <h4
                                        style="margin: 0 0 20px 0; font-size: 16px; color: #1e293b; display: flex; align-items: center; gap: 8px;">
                                        <span
                                            style="width: 6px; height: 6px; background: #ef4444; border-radius: 50%;"></span>
                                        TOP SERVICIOS CR√çTICOS
                                    </h4>
                                    <div id="sum-critical-list"
                                        style="display: flex; flex-direction: column; gap: 10px;">
                                        <!-- Injected via JS -->
                                        <div style="text-align:center; color:#94a3b8; font-size:12px; padding:20px;">
                                            Analizando datos...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SMART HUB TAB (AI OPERATIONS COCKPIT) -->
                    <div class="tab-content" id="tab-smarthub">
                        <!-- INTEL HEADER: COCKPIT VIEW -->
                        <div class="module-card"
                            style="margin-bottom: 30px; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 1px solid rgba(255,255,255,0.1); position: relative; overflow: hidden; padding: 30px; border-radius: 20px;">
                            <div
                                style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: rgba(59, 130, 246, 0.1); border-radius: 50%; filter: blur(50px);">
                            </div>

                            <h2
                                style="color: #ffffff; font-size: 26px; margin-bottom: 12px; display: flex; align-items: center; gap: 18px; font-weight: 800; letter-spacing: -0.5px;">
                                <span
                                    style="background: rgba(59, 130, 246, 0.2); width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 12px; font-size: 24px;">üß†</span>
                                AI OPERATIONS COCKPIT
                            </h2>
                            <p
                                style="color: rgba(255,255,255,0.65); font-size: 15px; max-width: 850px; line-height: 1.7; margin-bottom: 30px;">
                                Bienvenido al centro de mando inteligente de <strong>SIFU Informer</strong>. Este
                                ecosistema
                                de ultra-alta eficiencia integra algoritmos
                                de aprendizaje profundo, automatizaci√≥n t√°ctica y m√©tricas de impacto para una toma de
                                decisiones estrat√©gica sin precedentes.
                            </p>

                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                                <div
                                    style="background: rgba(255,255,255,0.03); padding: 18px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.08); text-align: center; backdrop-filter: blur(5px);">
                                    <div style="font-size: 22px; margin-bottom: 10px;">ü§ñ</div>
                                    <div
                                        style="font-size: 9px; color: rgba(255,255,255,0.7); text-transform: uppercase; font-weight: 800; letter-spacing: 1px; margin-bottom: 4px;">
                                        Algoritmos</div>
                                    <div style="font-size: 14px; color: #60a5fa; font-weight: 700;">OPT-SYNC</div>
                                </div>
                                <div
                                    style="background: rgba(255,255,255,0.03); padding: 18px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.08); text-align: center; backdrop-filter: blur(5px);">
                                    <div style="font-size: 22px; margin-bottom: 10px;">üîÆ</div>
                                    <div
                                        style="font-size: 9px; color: rgba(255,255,255,0.7); text-transform: uppercase; font-weight: 800; letter-spacing: 1px; margin-bottom: 4px;">
                                        Predictivo</div>
                                    <div style="font-size: 14px; color: #34d399; font-weight: 700;">ESTABLE</div>
                                </div>
                                <div
                                    style="background: rgba(255,255,255,0.03); padding: 18px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.08); text-align: center; backdrop-filter: blur(5px);">
                                    <div style="font-size: 22px; margin-bottom: 10px;">üî•</div>
                                    <div
                                        style="font-size: 9px; color: rgba(255,255,255,0.7); text-transform: uppercase; font-weight: 800; letter-spacing: 1px; margin-bottom: 4px;">
                                        Riesgo Ops</div>
                                    <div style="font-size: 14px; color: #f87171; font-weight: 700;">BAJO</div>
                                </div>
                                <div
                                    style="background: rgba(255,255,255,0.03); padding: 18px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.08); text-align: center; backdrop-filter: blur(5px);">
                                    <div style="font-size: 22px; margin-bottom: 10px;">üåü</div>
                                    <div
                                        style="font-size: 9px; color: rgba(255,255,255,0.7); text-transform: uppercase; font-weight: 800; letter-spacing: 1px; margin-bottom: 4px;">
                                        Impacto ESG</div>
                                    <div style="font-size: 14px; color: #fbbf24; font-weight: 700;">√ìPTIMO</div>
                                </div>
                            </div>
                        </div>

                        <!-- FASE 1 MODULES -->
                        <div class="smart-hub-grid"
                            style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                            <!-- LEFT COLUMN -->
                            <div style="display: flex; flex-direction: column; gap: 20px;">
                                <!-- CHECKLIST DIARIO -->
                                <div class="module-card">
                                    <h3>‚úÖ CHECKLIST DIARIO AUTOMATIZADO</h3>
                                    <div id="checklist-container">
                                        <div class="empty-state">Cargando tareas...</div>
                                    </div>
                                </div>

                                <!-- CALENDARIO INTELIGENTE -->
                                <div class="module-card">
                                    <h3>üìÖ CALENDARIO INTELIGENTE</h3>
                                    <div id="calendar-container">
                                        <div class="empty-state">Cargando calendario...</div>
                                    </div>
                                </div>
                            </div>

                            <!-- RIGHT COLUMN -->
                            <div style="display: flex; flex-direction: column; gap: 20px;">
                                <!-- AN√ÅLISIS DE TENDENCIAS -->
                                <div class="module-card">
                                    <h3>üìä AN√ÅLISIS DE TENDENCIAS (√öLTIMOS 30 D√çAS)</h3>
                                    <div id="trends-chart-container">
                                        <div class="empty-state">Recopilando datos hist√≥ricos...</div>
                                    </div>
                                </div>

                                <!-- INSIGHTS PREDICTIVOS -->
                                <div class="module-card">
                                    <h3>üîÆ INSIGHTS PREDICTIVOS</h3>
                                    <div id="insights-container">
                                        <div class="empty-state">Analizando patrones...</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- FASE 2 MODULES -->
                        <div
                            style="margin-top: 30px; padding-top: 30px; border-top: 3px solid var(--border-color, #e8eaed);">
                            <h2 style="margin-bottom: 25px; color: #667eea;">ü§ñ M√ìDULOS AVANZADOS DE IA</h2>

                            <!-- AI PREDICTIONS & RECOMMENDATIONS -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                                <div class="module-card">
                                    <h3>üîÆ PREDICCIONES DE IA</h3>
                                    <div id="ai-predictions-container">
                                        <div class="empty-state">Generando predicciones...</div>
                                    </div>
                                </div>

                                <div class="module-card">
                                    <h3>üí° RECOMENDACIONES INTELIGENTES</h3>
                                    <div id="ai-recommendations-container">
                                        <div class="empty-state">Analizando datos...</div>
                                    </div>
                                </div>
                            </div>

                            <!-- WORKER PERFORMANCE DASHBOARD -->
                            <div class="module-card" style="margin-bottom: 30px;">
                                <h3>üë• DASHBOARD DE RENDIMIENTO POR TRABAJADOR</h3>
                                <div id="worker-list-container">
                                    <div class="empty-state">Cargando datos de trabajadores...</div>
                                </div>
                            </div>

                            <!-- SUBSTITUTE MANAGEMENT -->
                            <div class="module-card">
                                <h3>üîÑ GESTI√ìN AVANZADA DE SUPLENCIAS</h3>
                                <div id="substitute-manager-container">
                                    <div class="empty-state">Cargando sistema de suplencias...</div>
                                </div>
                            </div>
                        </div>

                        <!-- FASE 4 MODULES - MACHINE LEARNING -->
                        <div
                            style="margin-top: 30px; padding-top: 30px; border-top: 3px solid var(--border-color, #e8eaed);">
                            <h2 style="margin-bottom: 25px; color: #667eea;">üß† MACHINE LEARNING Y OPTIMIZACI√ìN</h2>

                            <!-- ML PREDICTIONS & ANOMALIES -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                                <div class="module-card">
                                    <h3>üß† PREDICCIONES ML</h3>
                                    <div id="ml-predictions-container">
                                        <div class="empty-state">Entrenando modelo...</div>
                                    </div>
                                </div>

                                <div class="module-card">
                                    <h3>üîç DETECCI√ìN DE ANOMAL√çAS</h3>
                                    <div id="ml-anomalies-container">
                                        <div class="empty-state">Analizando...</div>
                                    </div>
                                </div>
                            </div>

                            <!-- ROUTE OPTIMIZATION -->
                            <div class="module-card" style="margin-bottom: 30px;">
                                <h3>üó∫Ô∏è OPTIMIZACI√ìN DE RUTAS</h3>
                                <div id="route-optimization-container">
                                    <div class="empty-state">Calculando rutas √≥ptimas...</div>
                                </div>
                            </div>

                            <!-- SERVICE CLUSTERING -->
                            <div class="module-card">
                                <h3>üéØ CLUSTERING DE SERVICIOS</h3>
                                <div id="service-clustering-container">
                                    <div class="empty-state">Agrupando servicios...</div>
                                </div>
                            </div>
                        </div>

                        <!-- FASE 5 MODULES - INTEGRACIONES Y AUTOMATIZACI√ìN -->
                        <div
                            style="margin-top: 30px; padding-top: 30px; border-top: 3px solid var(--border-color, #e8eaed);">
                            <h2 style="margin-bottom: 25px; color: #667eea;">üîå INTEGRACIONES Y AUTOMATIZACI√ìN</h2>

                            <!-- INTEGRATIONS PANEL -->
                            <div class="module-card" style="margin-bottom: 30px;">
                                <h3>üîå PANEL DE INTEGRACIONES</h3>
                                <div id="integrations-panel-container">
                                    <div class="empty-state">Cargando integraciones...</div>
                                </div>
                            </div>

                            <!-- EXPORT PANEL -->
                            <div class="module-card">
                                <h3>üì§ EXPORTACI√ìN AVANZADA</h3>
                                <div id="export-panel-container">
                                    <div class="empty-state">Cargando opciones de exportaci√≥n...</div>
                                </div>
                            </div>
                        </div>

                        <!-- FASE 7 MODULES - BUSINESS INTELLIGENCE AVANZADO -->
                        <div
                            style="margin-top: 30px; padding-top: 30px; border-top: 3px solid var(--border-color, #e8eaed); background: rgba(0,0,0,0.4); margin-bottom: 20px; border-radius: 12px; padding: 20px;">
                            <h2
                                style="margin-bottom: 25px; color: #a5b4fc; display: flex; align-items: center; gap: 15px;">
                                <span>üìä BUSINESS INTELLIGENCE AVANZADO</span>
                                <span
                                    style="font-size: 10px; background: #6366f1; color: white; padding: 2px 8px; border-radius: 20px;">v7.0
                                    AI Powered</span>
                            </h2>

                            <div id="bi-dashboard-container">
                                <div class="empty-state" style="color: #9aa0a6;">Ejecutando motores de an√°lisis...
                                </div>
                            </div>
                        </div>

                        <!-- FASE 8 MODULES - SEGURIDAD Y AUDITOR√çA AVANZADA -->
                        <div data-permission="*"
                            style="margin-top: 30px; padding-top: 30px; border-top: 3px solid #ea4335; background: rgba(234, 67, 53, 0.05); margin-bottom: 20px; border-radius: 12px; padding: 20px;">
                            <h2
                                style="margin-bottom: 25px; color: #ea4335; display: flex; align-items: center; gap: 15px;">
                                <span>üîí SEGURIDAD Y AUDITOR√çA AVANZADA</span>
                                <span
                                    style="font-size: 10px; background: #ea4335; color: white; padding: 2px 8px; border-radius: 20px;">v8.0
                                    Professional</span>
                            </h2>

                            <div id="security-dashboard-container">
                                <div class="empty-state" style="color: #5f6368;">Cargando protocolos de seguridad...
                                </div>
                            </div>
                        </div>

                        <!-- FASE 9 MODULES - SISTEMA DE GESTI√ìN DE CALIDAD (SGA) -->
                        <div
                            style="margin-top: 30px; padding-top: 30px; border-top: 3px solid #34a853; background: rgba(52, 168, 83, 0.05); margin-bottom: 20px; border-radius: 12px; padding: 20px;">
                            <h2
                                style="margin-bottom: 25px; color: #34a853; display: flex; align-items: center; gap: 15px;">
                                <span>üèÜ GESTI√ìN DE CALIDAD Y COMPLIANCE (SGA)</span>
                                <span
                                    style="font-size: 10px; background: #34a853; color: white; padding: 2px 8px; border-radius: 20px;">ISO
                                    9001:2015 Ready</span>
                            </h2>

                            <div id="quality-management-container">
                                <div class="empty-state" style="color: #5f6368;">Sincronizando registros de
                                    auditor√≠a...</div>
                            </div>
                        </div>

                        <!-- FASE 10 MODULES - GESTI√ìN DOCUMENTAL Y FIRMA DIGITAL -->
                        <div
                            style="margin-top: 30px; padding-top: 30px; border-top: 3px solid #4285f4; background: rgba(66, 133, 244, 0.05); margin-bottom: 20px; border-radius: 12px; padding: 20px;">
                            <h2
                                style="margin-bottom: 25px; color: #4285f4; display: flex; align-items: center; gap: 15px;">
                                <span>üìÇ GESTI√ìN DOCUMENTAL Y FIRMA DIGITAL</span>
                                <span
                                    style="font-size: 10px; background: #4285f4; color: white; padding: 2px 8px; border-radius: 20px;">v10.0
                                    Secure Storage</span>
                            </h2>

                            <div id="document-manager-container">
                                <div class="empty-state" style="color: #5f6368;">Escaneando repositorio de
                                    documents...</div>
                            </div>
                        </div>

                        <!-- FASE 11 MODULES - CONTROL FINANCIERO Y RENTABILIDAD -->
                        <div
                            style="margin-top: 30px; padding-top: 30px; border-top: 3px solid #34a853; background: rgba(52, 168, 83, 0.05); margin-bottom: 20px; border-radius: 12px; padding: 20px;">
                            <h2
                                style="margin-bottom: 25px; color: #1e8e3e; display: flex; align-items: center; gap: 15px;">
                                <span>üí∞ CONTROL FINANCIERO Y RENTABILIDAD</span>
                                <span
                                    style="font-size: 10px; background: #34a853; color: white; padding: 2px 8px; border-radius: 20px;">v11.0
                                    Profit Engine</span>
                            </h2>

                            <div id="financial-analysis-container">
                                <div class="empty-state" style="color: #5f6368;">Calculando m√°rgenes operativos...
                                </div>
                            </div>
                        </div>

                        <!-- FASE 12 MODULES - GESTI√ìN DE FORMACI√ìN Y TALENTO -->
                        <div
                            style="margin-top: 30px; padding-top: 30px; border-top: 3px solid #764ba2; background: rgba(118, 75, 162, 0.05); margin-bottom: 20px; border-radius: 12px; padding: 20px;">
                            <h2
                                style="margin-bottom: 25px; color: #764ba2; display: flex; align-items: center; gap: 15px;">
                                <span>üéì GESTI√ìN DE FORMACI√ìN Y TALENTO</span>
                                <span
                                    style="font-size: 10px; background: #764ba2; color: white; padding: 2px 8px; border-radius: 20px;">v12.0
                                    SIFU Academy</span>
                            </h2>

                            <div id="talent-management-container">
                                <div class="empty-state" style="color: #5f6368;">Cargando perfiles de talento y
                                    planes de carrera...</div>
                            </div>
                        </div>

                        <!-- FASE 13 MODULES - GESTI√ìN DE FLOTA Y LOG√çSTICA -->
                        <div
                            style="margin-top: 30px; padding-top: 30px; border-top: 3px solid #ff9800; background: rgba(255, 152, 0, 0.05); margin-bottom: 20px; border-radius: 12px; padding: 20px;">
                            <h2
                                style="margin-bottom: 25px; color: #f57c00; display: flex; align-items: center; gap: 15px;">
                                <span>üöö GESTI√ìN DE FLOTA Y LOG√çSTICA</span>
                                <span
                                    style="font-size: 10px; background: #ff9800; color: white; padding: 2px 8px; border-radius: 20px;">v13.0
                                    Fleet Connect</span>
                            </h2>

                            <div id="fleet-logistics-container">
                                <div class="empty-state" style="color: #5f6368;">Sincronizando telemetr√≠a de flota y
                                    niveles de stock...</div>
                            </div>
                        </div>

                        <!-- FASE 14 MODULES - SOSTENIBILIDAD Y RSC -->
                        <div
                            style="margin-top: 30px; padding-top: 30px; border-top: 3px solid #34a853; background: rgba(52, 168, 83, 0.05); margin-bottom: 20px; border-radius: 12px; padding: 20px;">
                            <h2
                                style="margin-bottom: 25px; color: #34a853; display: flex; align-items: center; gap: 15px;">
                                <span>üå± SOSTENIBILIDAD Y RSC (ESG)</span>
                                <span
                                    style="font-size: 10px; background: #34a853; color: white; padding: 2px 8px; border-radius: 20px;">v14.0
                                    Eco Impact</span>
                            </h2>

                            <div id="sustainability-csr-container">
                                <div class="empty-state" style="color: #5f6368;">Calculando impacto social y
                                    ambiental...</div>
                            </div>
                        </div>

                        <!-- FASE 15 MODULES - CENTRO DE MANDO DIRECTIVO -->
                        <div
                            style="margin-top: 50px; padding-top: 50px; border-top: 5px solid #202124; background: #fafafa; margin-bottom: 30px; border-radius: 20px; padding: 30px;">
                            <h2
                                style="margin-bottom: 35px; color: #202124; display: flex; align-items: center; gap: 20px;">
                                <span
                                    style="background: #202124; color: white; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 12px;">üèõÔ∏è</span>
                                <span>CENTRO DE MANDO DIRECTIVO (EXECUTIVE)</span>
                                <span
                                    style="font-size: 11px; background: #4285f4; color: white; padding: 4px 12px; border-radius: 20px;">v15.0
                                    Strategic View</span>
                            </h2>

                            <div id="executive-command-container">
                                <div class="empty-state" style="color: #5f6368;">Iniciando protocolos de mando
                                    estrat√©gico...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Hud Footer -->
        <footer class="hud-footer">
            <div id="current-date"></div>
            <div class="live-ticker">
                <span id="live-ticker-text">CARGANDO CEREBRO OPERATIVO...</span>
            </div>
            <div class="quick-input">
                <input type="text" id="quick-input-bar"
                    placeholder="COMANDO R√ÅPIDO: ESCRIBE PARA REGISTRAR INCIDENCIA...">
                <button id="voice-btn" class="voice-btn" title="Comando por Voz">üéôÔ∏è</button>
            </div>
        </footer>

    </div>

    <!-- Notification Center Panel -->
    <div id="notification-center-panel">
        <div class="notification-panel-header">
            <h3>üîî Notificaciones</h3>
            <button class="btn-close-notifications" onclick="NotificationsEngine.toggleNotificationCenter()">√ó</button>
        </div>
        <div id="notification-center-list">
            <!-- Notificaciones inyectadas por JS -->
        </div>
        <div style="padding: 15px; border-top: 1px solid var(--border-color, #e8eaed);">
            <button class="btn-secondary" onclick="NotificationsEngine.clearAll()" style="width: 100%;">
                üóëÔ∏è Limpiar Todas
            </button>
        </div>
    </div>

    <!-- Modals -->
    <div id="incident-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>REGISTRAR INCIDENCIA</h2>
                <button class="close-modal">√ó</button>
            </div>
            <form id="incident-form">
                <div class="form-group">
                    <label>TRABAJADORA</label>
                    <input type="text" id="worker-name" required>
                </div>
                <div class="form-group">
                    <label>TIPO</label>
                    <select id="incident-type">
                        <option value="AUSENCIA">AUSENCIA / BAJA</option>
                        <option value="RETRASO">RETRASO</option>
                        <option value="OTRO">OTRO</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>PRIORIDAD</label>
                    <div class="radio-group">
                        <label><input type="radio" name="priority" value="LOW"> BAJA</label>
                        <label><input type="radio" name="priority" value="MID" checked> MEDIA</label>
                        <label><input type="radio" name="priority" value="HIGH"> ALTA</label>
                    </div>
                </div>
                <div class="form-group">
                    <label>DESCRIPCI√ìN</label>
                    <textarea id="incident-desc"></textarea>
                </div>
                <input type="hidden" id="incident-date">
                <input type="hidden" id="incident-time">
                <button type="submit" class="btn-submit">GUARDAR EN CEREBRO</button>
            </form>
        </div>
    </div>

    <div id="note-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>NUEVA TAREA</h2>
                <button class="close-modal">√ó</button>
            </div>
            <form id="note-form">
                <textarea id="note-text" placeholder="¬øQu√© hay que hacer?" required></textarea>
                <button type="submit" class="btn-submit">A√ëADIR A AGENDA</button>
            </form>
        </div>
    </div>

    <!-- FAB -->
    <div class="fab-container">
        <div class="fab-menu" id="fab-menu">
            <button class="fab-item" id="btn-add-incident-v2" title="Informar Incidencia">üö®</button>
            <button class="fab-item" id="btn-add-note-v2" title="Nueva Tarea">üìù</button>
        </div>
        <button class="main-fab" id="main-fab">+</button>
    </div>

    <!-- Quality Audit Modal -->
    <div id="quality-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>REGISTRAR AUDITOR√çA DE CALIDAD</h2>
                <button class="close-modal" onclick="closeQualityModal()">&times;</button>
            </div>
            <form id="quality-form">
                <div class="form-group">
                    <label>SERVICIO / CENTRO</label>
                    <select id="quality-service-select" required>
                        <!-- Options injected via JS -->
                    </select>
                </div>
                <div class="form-group">
                    <label>PUNTUACI√ìN (1-10)</label>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <input type="range" id="quality-score-range" min="1" max="10" value="8" style="flex:1;"
                            oninput="document.getElementById('score-val-label').textContent = this.value">
                        <span id="score-val-label"
                            style="font-size:24px; font-weight:800; min-width:30px; color:var(--accent-green);">8</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>EVALUACI√ìN DEL SUPERVISOR</label>
                    <textarea id="quality-notes"
                        placeholder="Detalla el estado del servicio, limpieza de rincones, reposici√≥n de material, etc..."></textarea>
                </div>
                <div class="form-group">
                    <label>FOTO DE EVIDENCIA (SIMULADO)</label>
                    <div class="photo-placeholder"
                        style="border:2px dashed #ccc; border-radius:12px; height:100px; display:flex; align-items:center; justify-content:center; cursor:pointer;"
                        onclick="showToast('Sincronizando c√°mara...')">
                        <span>üì∏ Click para adjuntar foto</span>
                    </div>
                </div>
                <button type="submit" class="btn-submit">FINALIZAR AUDITOR√çA</button>
            </form>
        </div>
    </div>

    <!-- Calendar Event Detail Modal -->
    <div id="calendar-modal" class="modal">
        <div class="modal-content calendar-modal-content">
            <div class="modal-header">
                <h2 id="calendar-modal-title">DETALLES DEL D√çA</h2>
                <button class="close-modal" onclick="CalendarModule.closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="calendar-modal-date" class="calendar-modal-date">Lunes, 14 de Febrero</div>

                <div class="calendar-modal-tabs">
                    <button class="modal-tab-btn active" id="tab-btn-events"
                        onclick="CalendarModule.switchModalTab('events')">EVENTOS</button>
                    <button class="modal-tab-btn" id="tab-btn-add" onclick="CalendarModule.switchModalTab('add')">A√ëADIR
                        EVENTO</button>
                </div>

                <div id="calendar-modal-content-events" class="modal-tab-content active">
                    <div class="events-list-container" id="calendar-modal-list">
                        <!-- Events list injected via JS -->
                    </div>
                </div>

                <div id="calendar-modal-content-add" class="modal-tab-content">
                    <form id="calendar-add-event-form" onsubmit="CalendarModule.handleFormSubmit(event)">
                        <div class="form-group">
                            <label>TITULO DE LA TAREA / EVENTO</label>
                            <input type="text" id="event-title" required placeholder="Ej: Reuni√≥n con cliente">
                        </div>
                        <div class="form-group">
                            <label>DESCRIPCI√ìN</label>
                            <textarea id="event-desc" placeholder="Detalles adicionales..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>CATEGOR√çA</label>
                            <select id="event-tag-type">
                                <option value="manual_event">General</option>
                                <option value="manual_urgent">Urgente</option>
                                <option value="manual_audit">Auditor√≠a</option>
                                <option value="manual_task">Tarea</option>
                            </select>
                        </div>
                        <button type="submit" class="btn-submit">GUARDAR EN CALENDARIO</button>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- Persistent Emergency Hub (Director View) -->
    <div id="emergency-popup-container" class="emergency-popup-fixed" style="display:none;">
        <div class="popup-header">
            <span>üî• CENTROS DESCUBIERTOS</span>
            <button onclick="this.parentElement.parentElement.classList.toggle('minimized')">_</button>
        </div>
        <div id="emergency-list" class="popup-content">
            <!-- Dynamic Content -->
        </div>
    </div>




    <!-- Situational Report Modal -->
    <div id="situational-report-modal" class="modal">
        <div class="modal-content report-modal-content">
            <div class="report-header">
                <div class="report-title-group">
                    <div class="report-icon">üìä</div>
                    <div>
                        <h2>INFORME DE SITUACI√ìN EN TIEMPO REAL</h2>
                        <span class="report-subtitle">AN√ÅLISIS OPERATIVO 360¬∞ | ACTUALIZADO: AHORA MISMO</span>
                    </div>
                </div>
                <button class="close-modal" onclick="closeSituationalReport()">&times;</button>
            </div>

            <div class="report-body">
                <!-- Top Metrics Row -->
                <div class="report-metrics-grid">
                    <div class="metric-card coverage">
                        <div class="metric-label">COBERTURA TOTAL</div>
                        <div class="metric-value" id="report-coverage-val">--%</div>
                        <div class="metric-trendup">Objetivo: 98%</div>
                    </div>
                    <div class="metric-card active">
                        <div class="metric-label">OPERATIVOS ACTIVOS</div>
                        <div class="metric-value" id="report-active-val">--</div>
                    </div>
                    <div class="metric-card risk">
                        <div class="metric-label">DESCUBIERTOS</div>
                        <div class="metric-value" id="report-uncovered-val">--</div>
                        <div class="metric-sub">Requiere Atenci√≥n</div>
                    </div>
                    <div class="metric-card warning">
                        <div class="metric-label">ABSENTISMO TOTAL</div>
                        <div class="metric-value" id="report-absences-val">--</div>
                        <div class="metric-sub">Bajas + IT + Vacs</div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="report-charts-grid">
                    <div class="chart-container">
                        <h4>ESTADO DE LA FUERZA LABORAL</h4>
                        <div class="canvas-wrapper">
                            <canvas id="reportChartCoverage"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h4>DESGLOSE DE AUSENCIAS</h4>
                        <div class="canvas-wrapper">
                            <canvas id="reportChartAbsences"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Analysis & Action Row -->
                <div class="report-analysis-grid">
                    <div class="analysis-card hotspots">
                        <h4>üî• PUNTOS CALIENTES (HOTSPOTS)</h4>
                        <ul id="report-hotspots-list" class="report-list">
                            <!-- Injected via JS -->
                        </ul>
                    </div>
                    <div class="analysis-card actions">
                        <h4>‚ö° PLAN DE ACCI√ìN RECOMENDADO</h4>
                        <ul id="report-actions-list" class="report-list action-mode">
                            <!-- Injected via JS -->
                        </ul>
                    </div>
                </div>
            </div>

            <div class="report-footer">
                <div class="footer-info">Generado autom√°ticamente por el motor de an√°lisis operativo basado en
                    Master
                    Data.
                </div>
                <div class="footer-actions">
                    <button class="btn-report-action excel" onclick="downloadReportExcel()">üìä EXCEL</button>
                    <button class="btn-report-action pdf" onclick="downloadReportPDF()">üìÑ PDF</button>
                    <button class="btn-report-action print" onclick="window.print()">üñ®Ô∏è IMPRIMIR</button>
                    <button class="btn-report-action close" onclick="closeSituationalReport()">CERRAR
                        INFORME</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Generic Status Details Modal -->
    <div id="status-detail-modal" class="modal">
        <div class="status-modal-content">
            <div class="modal-header">
                <h2 id="status-modal-title">DETALLE</h2>
                <button class="close-modal" onclick="closeStatusModal()">√ó</button>
            </div>
            <div id="status-modal-body">
                <!-- Dynamic Content -->
            </div>
            <div class="status-modal-footer">
                <button class="btn-modal-action excel" onclick="exportStatusToExcel()">
                    <span>üìä</span> EXCEL
                </button>
                <button class="btn-modal-action pdf" onclick="exportStatusToPDF()">
                    <span>üìÑ</span> PDF
                </button>
                <button class="btn-modal-action back" onclick="closeStatusModal()">
                    VOLVER
                </button>
            </div>
        </div>
    </div>

    <!-- PDF Export Lib -->
    <!-- Microsoft Authentication Library -->
    <script src="https://alcdn.msauth.net/browser/2.35.0/js/msal-browser.min.js"></script>

    <!-- PDF Export Lib -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <!-- Main Application Core -->
    <script src="indexeddb-persist.js"></script>
    <script src="master_data.js"></script>
    <script src="special_covering_data.js"></script>
    <script src="orders_data.js"></script>

    <!-- Engine Modules -->
    <script src="operational_service.js"></script>
    <script src="analytics_engine.js"></script>
    <script src="quality_module.js"></script>
    <script src="orders_module.js"></script>
    <script src="it_module.js"></script>
    <script src="director_module.js"></script>
    <script src="quadrants_module.js"></script>
    <script src="notepad.js"></script>

    <!-- Smart Modules -->
    <script src="notifications_engine.js"></script>
    <script src="daily_checklist.js"></script>
    <script src="calendar_module.js"></script>
    <script src="analytics_trends.js"></script>

    <!-- Advanced Modules (Fase 2) -->
    <script src="ai_predictive_engine.js"></script>
    <script src="worker_performance.js"></script>
    <script src="substitute_management.js"></script>

    <!-- Mobile & Chat (Fase 3) -->
    <script src="pwa_installer.js"></script>
    <script src="internal_chat.js"></script>

    <!-- Machine Learning (Fase 4) -->
    <script src="ml_engine.js"></script>
    <script src="route_optimizer.js"></script>
    <script src="service_clustering.js"></script>

    <!-- Integrations & Export (Fase 5) -->
    <script src="integrations_hub.js"></script>
    <script src="advanced_export.js"></script>

    <!-- Business Intelligence (Fase 7) -->
    <script src="bi_engine.js"></script>

    <!-- Security & RBAC (Fase 8) -->
    <script src="security_manager.js"></script>

    <!-- Quality & Compliance (Fase 9) -->
    <script src="quality_compliance.js"></script>

    <!-- Document Management & Signature (Fase 10) -->
    <script src="document_manager.js"></script>

    <!-- Financial Management (Fase 11) -->
    <script src="financial_manager.js"></script>

    <!-- Talent & Training (Fase 12) -->
    <script src="talent_manager.js"></script>

    <!-- Fleet & Logistics (Fase 13) -->
    <script src="fleet_logistics_manager.js"></script>

    <!-- Sustainability & CSR (Fase 14) -->
    <script src="sustainability_manager.js"></script>

    <!-- Executive Command (Fase 15) -->
    <script src="executive_command.js"></script>
    <script src="contract_guardian.js?v=1.0"></script>

    <!-- App Logic (Centralized Failsafe) -->
    <script src="app.js?v=6.5"></script>

</body>

</html>